% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/unit.R
\name{unit}
\alias{unit}
\alias{unit<-}
\title{Lightweight unit getter/setter (conversion + optional rounding)}
\usage{
unit(x)

unit(x) <- value
}
\arguments{
\item{x}{A numeric vector (or column) to query or tag with a \code{"unit"} attribute.}

\item{value}{Character scalar describing the assignment. See the accepted forms above.
Examples: \code{"degF"}, \code{"degC -> degF"}, \code{"degC|degF|1"},
\code{"degF (2)"}, \code{"degF; round=1"}.}
}
\value{
\itemize{
\item \code{unit(x)} returns the current unit attribute (character scalar) or \code{NULL}.
\item \code{unit(x) <- value} returns the modified vector \code{x}, with values converted
if needed, optionally rounded, and \code{attr(x, "unit")} set to the target unit.
When rounding is applied, \code{attr(x, "unit_digits")} is also set.
}
}
\description{
Provides a simple way to read and set a \code{"unit"} attribute on numeric
vectors. The replacement form (\code{unit(x) <- value}) can also convert values
between supported units (handled by the package-internal
\code{.convert_units()}) and optionally round the result.
}
\details{
\strong{Accepted assignment forms for \code{value}:}
\itemize{
\item \code{"degF"} — set/convert to \code{degF} using the current attribute
as the source (if present).
\item \code{"degC -> degF"} — explicitly convert from \code{degC} to \code{degF}.
\item \code{"degC|degF"} — shorthand for the arrow form above.
\item Optional rounding may be requested (highest precedence first):
\code{"...; round=1"}, \code{"...; digits=1"}, trailing \code{"|1"},
or trailing \code{"(1)"}; e.g., \code{"degC|degF|1"} or \code{"degF (2)"}.
}

If an explicit source unit is provided on the left side (e.g.,
\code{"degC -> degF"}), it is treated as authoritative. To prevent accidental
re-interpretation of already-tagged data, a source-mismatch policy is applied:

\itemize{
\item \code{options(jj.unit.on_src_mismatch = "warn_noop")} (default) —
warn and do nothing when \emph{declared source} differs from
\code{attr(x,"unit")}.
\item \code{"error"} — stop with an error.
\item \code{"convert"} — trust the declared source and convert anyway
(original permissive behavior).
}

Rounding is applied \emph{after} conversion. Global default rounding can be set via
\code{options(jj.unit.round_digits = K)}. This default is only applied when a
conversion actually occurred; inline digits (\code{round=} / \code{digits=} /
\code{|K} / \code{(K)}) always apply. When rounding occurs, the setter also records
\code{attr(x, "unit_digits") = K}.

To avoid silently mislabeling temperatures, you may forbid “tag-only” temperature
assignments (no known source) by enabling:
\code{options(jj.unit.disallow_temp_tag_only = TRUE)}. With this option set,
attempting \code{unit(x) <- "degF"} on an untagged vector will error; use
\code{"src|dst"} instead.
}
\section{Conversions}{

The actual numeric conversions are performed by the internal
\code{.convert_units(x, from, to)}. Typical pairs supported in this package
include temperature (\code{degC}, \code{degF}, \code{K}/\code{degK}), pressure
(\code{hPa}, \code{Pa}), wind speed (\code{m/s}, \code{mph}, \code{kt}),
precipitation depth (\code{kg/m^2}, \code{mm}, \code{in}), radiation
(\code{W/m^2}), and relative humidity forms (where supported by your map).
}

\examples{
x <- c(25, 26, 27)
unit(x) <- "degC"        # tag as degC
unit(x)                  # "degC"

# Convert using current attribute as the source
unit(x) <- "degF"        # C -> F (if attr is "degC")

# Explicit source -> target
unit(x) <- "degF -> degC"

# Shorthand with rounding
unit(x) <- "degC|degF|1"   # C -> F, then round(., 1)
unit(x) <- "degF (2)"      # tag/convert to F, then round(., 2)

# Safer everyday pattern (idempotent):
y <- c(0, 5, 10); unit(y) <- "degC"
unit(y) <- "degF"          # converts once; calling again is a no-op

# data.table in-place usage
if (requireNamespace("data.table", quietly = TRUE)) {
  library(data.table)
  DT <- data.table(ta = c(25, 26, 27))
  unit(DT$ta) <- "degC"
  DT[, ta := { unit(ta) <- "degC -> degF; round=1"; ta }]
  unit(DT$ta)                    # "degF"
  attr(DT$ta, "unit_digits")     # 1
}

# Policies (optional):
# options(jj.unit.on_src_mismatch = "warn_noop")  # default
# options(jj.unit.on_src_mismatch = "error")
# options(jj.unit.on_src_mismatch = "convert")
#
# options(jj.unit.round_digits = 1L)              # global rounding (after conversions)
# options(jj.unit.disallow_temp_tag_only = TRUE)  # forbid tag-only for temperatures

}
